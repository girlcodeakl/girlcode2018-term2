<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset='utf-8'>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <title>Message Feed</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300" rel="stylesheet">
  <link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.4/jquery.mobile-1.4.4.min.css">
  <script src="https://code.jquery.com/mobile/1.4.4/jquery.mobile-1.4.4.min.js"></script>
  </head>
  <img class="logo" src="/images/Blender-logo.png"/>
  <body>
    <div class="topnav">
      <a href="/index.html">Home</a>
      <a href="/feed.html">My favourites</a>
      <a href="/feed2.html">Read the feed</a>
      <a href="/post.html">Post something</a>
    </div>
    <div id="container">
      <div class="card">
        <img class="avatar"  src="https://tympanus.net/Development/CardStackEffects/img/1.png">
      </div>
      <div class="card">
        <img class="avatar"  src="https://tympanus.net/Development/CardStackEffects/img/2.png">
      </div>
      <div class="card">
        <img class="avatar"  src="https://tympanus.net/Development/CardStackEffects/img/3.png">
      </div>
      <div class="card">
        <img class="avatar"  src="https://tympanus.net/Development/CardStackEffects/img/4.png">
      </div>
    </div>
    <h1 class="title">Message Feed</h1>
    <div class="message-list">
    </div>

  </div>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-dateFormat/1.0/jquery.dateFormat.js"></script>
    <script>


//Hello! This is the start of the JavaScript.

function displayMessage(post) {
  let postElement = $('<div class="card"></div>');
  $("#container").append(postElement);

  let imageElement = $('<img class="avatar" src='+ post.image + '>');
postElement.append(imageElement);

  let timeElement = $('<div class="time">' + $.format.prettyDate(post.time) + '</div>');
  postElement.append(timeElement);

  let authorElement = $('<div class="name">' + post.author + '</div>');
  postElement.append(authorElement);

  let messageElement = $('<div class="message">' + post.message + '</div>');
  postElement.append(messageElement) + postElement.append(timeElement);

  let idElement = $('<div class="postId">' + post.id + '</div>');
  postElement.append(idElement);
  swipe ()
}

function createFeed(posts) {
  $("#container").empty();
  posts.forEach(displayMessage);
}

function nextpost(posts) {
  $.get("/random", createFeed);
}

  function nextpostYes(posts) {
    $.get("/random", createFeed);
    let data = {}
    data.postId = $(".postId").text();
    $.post("/favourites", data);
}

function nextpostNo(posts) {
  $.get("/random", createFeed);
}

//function calls for next post when page loads so won't load a blank feed
nextpost();

//$.get("/random", createFeed);

//tree vector pictures designed by Freepik
function swipe (){

    $('img').on('dragstart', function(event) { event.preventDefault(); });

    $(".card").on("swiperight",function(){
      setTimeout(nextpostYes, 1700);
      $(this).addClass('rotate-left').delay(700).fadeOut(1);
      $(this).append('<div class="status like">Like!</div>');
    });

   $(".card").on("swipeleft",function(){
    setTimeout(nextpostNo, 1700);
    $(this).addClass('rotate-right').delay(700).fadeOut(1);
    $(this).append('<div class="status dislike">Dislike!</div>');
  });
};

//This is the end of the JavaScript.
    </script>
  </body>
</html>
